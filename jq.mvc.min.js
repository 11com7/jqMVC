(function(c){c.mvc={};c.mvc.app=function(){return{_loadTimer:null,_modelsReady:!1,_controllersReady:!1,_loadedListeners:[],_modelsLoaded:0,_totalModels:0,_templateType:"text/html",_controllersDir:"controllers/",_modelsDir:"models/",listenHashChange:function(){window.addEventListener("hashchange",function(b){var a=document.location.hash.replace("#","/");c.mvc.route(a,b)})},controllersPath:function(b){this._controllersDir=b},modelsDir:function(b){this._modelsDir=b},setViewType:function(){this._templateType=
typel},ready:function(b){if(this.loaded)b();else c(document).one("jqmvc:loaded",b)},loadControllers:function(b){var a=this;c(document).ready(function(){a._loadTimer=setTimeout(function(){},1500);typeof b==="string"&&(b=[b]);for(var d=0;d<b.length;d++){var e=document.createElement("script");e.src=a._controllersDir+b[d]+".js";e.onerror=function(b){console.log("error ",b)};c("head").append(e);a._loadedListeners[b[d]]=1;c(document).one(b[d]+":ready",function(b){delete a._loadedListeners[b.modelName];
if(a._loadedListeners.length==0)a._controllersReady=!0,a._modelsReady&&c(document).trigger("jqmvc:loaded")});delete e}})},loadModels:function(b){var a=this;clearTimeout(this._loadTimer);c(document).ready(function(){typeof b==="string"&&(b=[b]);a._totalModels=b.length;for(var d=0;d<b.length;d++){var e=document.createElement("script");e.src=a._modelsDir+b[d]+".js";e.onload=function(){a._modelsLoaded++;if(a._modelsLoaded>=a._totalModels)a._modelsReady=!0,a._controllersReady&&c(document).trigger("jqmvc:loaded")};
e.onerror=function(b){console.log("error ",b)};c("head").append(e);delete e}})}}};var h=document.location.protocol+"//"+document.location.host,g=[],a={},e={},d={};c.mvc.controller={};c.mvc.controller.create=function(b,f){var j=!0;c.mvc.controller[b]=f;a[b]=0;e[b]=0;f.hasOwnProperty("init")&&(d[b]=f);if(f.hasOwnProperty("views")&&(f.views.length>0||Object.keys(f.views).length)>0)for(var i in j=!1,a[b]=f.views.length||Object.keys(f.views).length,f.views){var h=typeof i==="number"?f.views[i]:i;!g[h]&&
jq("#"+h).length==0&&(c.mvc.controller.addView(f.views[i],b,h),g[h]=1)}j&&(c(document).trigger(b+":ready"),d[b]&&d[b].init.apply(d[b]))};c.mvc.route=function(b,a){b.indexOf(h)===0&&(b=b.substring(h.length,b.length));b[0]=="/"&&(b=b.substr(1));b=b.split("/");if(b.length>1)var e=b.splice(0,1),d=b.splice(0,1);else e=b[0],d="default";if(c.mvc.controller[e]&&c.mvc.controller[e].hasOwnProperty(d)){a&&a.preventDefault();try{c.mvc.controller[e][d].apply(c.mvc.controller[e],b)}catch(g){console.log("Error with MVC handler - "+
g.message,g)}return!0}return!1};c.mvc.addRoute=function(a,e){a.indexOf(h)===0&&(a=a.substring(h.length,a.length));a[0]=="/"&&(a=a.substr(1));a=a.split("/");if(a.length>1)var d=a.splice(0,1),g=a.splice(0,1);else d=a[0],g="default";c.mvc.controller[d]||(c.mvc.controller[d]={});c.mvc.controller[d][g]=e};c.mvc.controller.addView=function(b,f,g){c.get(b,function(b){c(document.body).append(c("<script type='"+c.mvc.app._templateType+"' id='"+g+"'>"+b+"<\/script>"));e[f]++;e[f]==a[f]&&(c(document).trigger(f+
":ready"),d[f]&&d[f].init.apply(d[f]))})};if(c.ui)c.ui.customClickHandler=c.mvc.route;else c(document).on("click","a",function(a){try{c.mvc.route(a.target.href,a)&&a.preventDefault()}catch(d){console.log("Error "+d),a.preventDefault()}})})(jq);
(function(c){storageAdapters={};var h={};c.mvc.model=function(a,e){e&&e.modelName&&delete e.modelName;e&&e.id&&delete e.id;h[a]||(h[a]=e);c.extend(this,e);this.modelName=a};c.mvc.model.prototype={get:function(a,e){var d=this,b=new c.mvc.model(this.modelName,h[this.modelName]);storageAdapters[this.modelName].get(a,function(f){b=c.extend(b,f);b.modelName=d.modelName;b.id=a;if(e)return e(b);return b})},getAll:function(a){return storageAdapters[this.modelName].getAll(this.modelName,a)},save:function(a){return storageAdapters[this.modelName].save(this,
a)},remove:function(a){return storageAdapters[this.modelName].remove(this,a)},set:function(a,e){if(c.isObject(a))for(var d in a&&a.modelName&&delete a.modelName,a&&a.id&&delete a.id,a)this.hasOwnProperty(d)&&(this[d]=a[d]);else a.toLowerCase()!="id"&&a.toLowerCase()!="modelName"&&(this[a]=e)}};c.mvc.model.extend=function(a,e,d){storageAdapters[a]=d?d:(g.linkerCache[a]={},g);return function(){return new c.mvc.model(a,e)}};var g={linkerCache:{},save:function(a,e){if(!a.id)a.id=c.uuid();window.localStorage.setItem(a.id,
JSON.stringify(a));this.linkerCache[a.modelName][a.id]=1;window.localStorage.setItem(a.modelName+"_linker",JSON.stringify(this.linkerCache[a.modelName]));c(document).trigger(a.modelName+":save",a);if(e)return e(a)},get:function(a,c){var d=window.localStorage.getItem(a);try{d=JSON.parse(d)}catch(b){d={}}return c(d)},getAll:function(a,c){var d=JSON.parse(window.localStorage.getItem(a+"_linker")),b=[],f;for(f in d)if(localStorage[f]){var g=JSON.parse(localStorage[f]);g.modelName=a;g.id=f;b.push(g)}else delete d[f];
this.linkerCache[a]=d?d:{};window.localStorage.setItem(a+"_linker",JSON.stringify(this.linkerCache[a]));return c(b)},remove:function(a,e){window.localStorage.removeItem(a.id);delete this.linkerCache[a.modelName][a.id];window.localStorage.setItem(a.modelName+"_linker",JSON.stringify(this.linkerCache[a.modelName]));c(document).trigger(a.modelName+":remove",a.id);if(e)return e(a)}}})(jq);
(function(c){c.template=function(c,a){return h(c,a)};c.tmpl=function(g,a){return c(h(g,a))};var h=function(c,a){a||(a={});return tmpl(c,a)};(function(){var c={};this.tmpl=function e(d,b){var f=!/\W/.test(d)?c[d]=c[d]||e(document.getElementById(d).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+d.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+
"');}return p.join('');");return b?f(b):f}})()})(jq);
