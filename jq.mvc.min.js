(function(b){b.mvc={};b.mvc.app=function(){return{_loadTimer:null,_modelsReady:!1,_controllersReady:!1,_loadedListeners:[],_modelsLoaded:0,_totalModels:0,_templateType:"text/html",_controllersDir:"controllers/",_modelsDir:"models/",listenHashChange:function(){window.addEventListener("hashchange",function(c){var a=document.location.hash.replace("#","/");b.mvc.route(a,c)})},controllersPath:function(c){this._controllersDir=c},modelsDir:function(c){this._modelsDir=c},setViewType:function(){this._templateType=
typel},ready:function(c){if(this.loaded)c();else b(document).one("jqmvc:loaded",c)},loadControllers:function(c){var a=this;b(document).ready(function(){a._loadTimer=setTimeout(function(){},1500);typeof c==="string"&&(c=[c]);for(var e=0;e<c.length;e++){var d=document.createElement("script");d.src=a._controllersDir+c[e]+".js";d.onerror=function(c){console.log("error ",c)};b("head").append(d);a._loadedListeners[c[e]]=1;b(document).one(c[e]+":ready",function(c){delete a._loadedListeners[c.name];if(a._loadedListeners.length==
0)a._controllersReady=!0,a._modelsReady&&b(document).trigger("jqmvc:loaded")});delete d}})},loadModels:function(c){var a=this;clearTimeout(this._loadTimer);b(document).ready(function(){typeof c==="string"&&(c=[c]);a._totalModels=c.length;for(var e=0;e<c.length;e++){var d=document.createElement("script");d.src=a._modelsDir+c[e]+".js";d.onload=function(){a._modelsLoaded++;if(a._modelsLoaded>=a._totalModels)a._modelsReady=!0,a._controllersReady&&b(document).trigger("jqmvc:loaded")};d.onerror=function(a){console.log("error ",
a)};b("head").append(d);delete d}})}}};var g=document.location.protocol+"//"+document.location.host,i=[],a={},d={},e={};b.mvc.controller={};b.mvc.controller.create=function(c,f){var j=!1;b.mvc.controller[c]=f;a[c]=0;d[c]=0;f.hasOwnProperty("init")&&(e[c]=f);if(f.hasOwnProperty("views")&&(f.views.length>0||Object.keys(f.views).length)>0)for(var h in j=!1,a[c]=f.views.length||Object.keys(f.views).length,f.views){var g=typeof h==="number"?f.views[h]:h;!i[g]&&jq("#"+g).length==0&&(b.mvc.controller.addView(f.views[h],
c,g),i[g]=1)}j&&(b(document).trigger(c+":ready"),e[c]&&e[c].init.apply(e[c]))};b.mvc.route=function(a,e){a.indexOf(g)===0&&(a=a.substring(g.length,a.length));a[0]=="/"&&(a=a.substr(1));a=a.split("/");if(a.length>1)var d=a.splice(0,1),h=a.splice(0,1);else d=a[0],h="default";if(b.mvc.controller[d]&&b.mvc.controller[d].hasOwnProperty(h))return e&&e.preventDefault(),b.mvc.controller[d][h].apply(b.mvc.controller[d],a),!0;return!1};b.mvc.addRoute=function(a,e){a.indexOf(g)===0&&(a=a.substring(g.length,
a.length));a[0]=="/"&&(a=a.substr(1));a=a.split("/");if(a.length>1)var d=a.splice(0,1),h=a.splice(0,1);else d=a[0],h="default";b.mvc.controller[d]||(b.mvc.controller[d]={});b.mvc.controller[d][h]=e};b.mvc.controller.addView=function(c,f,g){b.get(c,function(c){b(document.body).append(b("<script type='"+b.mvc.app._templateType+"' id='"+g+"'>"+c+"<\/script>"));d[f]++;d[f]==a[f]&&(b(document).trigger(f+":ready"),e[f]&&e[f].init.apply(e[f]))})};if(b.ui)b.ui.customClickHandler=b.mvc.route;else b(document).on("click",
"a",function(a){$mvc.controller.route(a.target.href,a)})})(jq);
(function(b){storageAdapters={};var g={};b.mvc.model=function(a,d){d&&d.modelName&&delete d.modelName;d&&d.id&&delete d.id;g[a]||(g[a]=d);b.extend(this,d);this.name=a};b.mvc.model.prototype={get:function(a,d){var e=this,c=new b.mvc.model(this.name,g[this.name]);storageAdapters[this.name].get(a,function(f){c=b.extend(c,f);c.name=e.name;c.id=a;if(d)return d(c);return c})},getAll:function(a){return storageAdapters[this.name].getAll(this.name,a)},save:function(a){return storageAdapters[this.name].save(this,
a)},remove:function(a){return storageAdapters[this.name].remove(this,a)},set:function(a,d){if(b.isObject(a))for(var e in a&&a.name&&delete a.name,a&&a.id&&delete a.id,a)this.hasOwnProperty(e)&&(this[e]=a[e]);else a.toLowerCase()!="id"&&a.toLowerCase()!="name"&&(this[a]=d)}};b.mvc.model.extend=function(a,d,e){storageAdapters[a]=e?e:(i.linkerCache[a]={},i);return function(){return new b.mvc.model(a,d)}};var i={linkerCache:{},save:function(a,d){if(!a.id)a.id=b.uuid();try{if(window.localStorage.setItem(a.id,
JSON.stringify(a)),this.linkerCache[a.modelName][a.id]=1,window.localStorage.setItem(a.modelName+"_linker",JSON.stringify(this.linkerCache[a.modelName])),b(document).trigger(a.modelName+":save",a),d)return d(a)}catch(e){console.log(e)}},get:function(a,d){var b=window.localStorage.getItem(a);try{b=JSON.parse(b)}catch(c){b={}}return d(b)},getAll:function(a,b){try{var e=JSON.parse(window.localStorage.getItem(a+"_linker")),c=[],f;for(f in e)if(localStorage[f]){var g=JSON.parse(localStorage[f]);g.name=
a;g.id=f;c.push(g)}else delete e[f];this.linkerCache[a]=e?e:{};window.localStorage.setItem(a+"_linker",JSON.stringify(this.linkerCache[a]));return b(c)}catch(i){console.log(i)}},remove:function(a,d){try{if(window.localStorage.removeItem(a.id),delete this.linkerCache[a.name][a.id],window.localStorage.setItem(a.modelName+"_linker",JSON.stringify(this.linkerCache[a.modelName])),b(document).trigger(a.modelName+":remove",a.id),d)return d(a)}catch(e){console.log(e)}}}})(jq);
(function(b){b.template=function(b,a){return g(b,a)};b.tmpl=function(i,a){return b(g(i,a))};var g=function(b,a){a||(a={});return tmpl(b,a)};(function(){var b={};this.tmpl=function d(e,c){var f=!/\W/.test(e)?b[e]=b[e]||d(document.getElementById(e).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+
"');}return p.join('');");return c?f(c):f}})()})(jq);
