(function(b){b.mvc={};b.mvc.app=function(){return{_loadTimer:null,_modelsReady:!1,_controllersReady:!1,_loadedListeners:[],_modelsLoaded:0,_totalModels:0,_templateType:"text/html",_controllersDir:"controllers/",_modelsDir:"models/",listenHashChange:function(){window.addEventListener("hashchange",function(d){var a=document.location.hash.replace("#","/");b.mvc.route(a,d)})},controllersPath:function(d){this._controllersDir=d},modelsDir:function(d){this._modelsDir=d},setViewType:function(){this._templateType=
typel},ready:function(d){if(this.loaded)d();else b(document).one("jqmvc:loaded",d)},loadControllers:function(d){var a=this;b(document).ready(function(){a._loadTimer=setTimeout(function(){a._modelsReady=!0;a._controllersReady&&b(document).trigger("jqmvc:loaded")},1500);typeof d==="string"&&(d=[d]);for(var c=0;c<d.length;c++){var e=document.createElement("script");e.src=a._controllersDir+d[c]+".js";e.onerror=function(a){console.log("error ",a)};b("head").append(e);a._loadedListeners[d[c]]=1;a._loadedListeners.length++;
b(document).one(d[c]+":ready",function(d){delete a._loadedListeners[d.data.name];a._loadedListeners.length--;if(a._loadedListeners.length==0)a._controllersReady=!0,a._modelsReady&&b(document).trigger("jqmvc:loaded")});delete e}})},loadModels:function(a){var f=this;clearTimeout(this._loadTimer);b(document).ready(function(){typeof a==="string"&&(a=[a]);f._totalModels=a.length;for(var c=0;c<a.length;c++){var e=document.createElement("script");e.src=f._modelsDir+a[c]+".js";e.onload=function(){f._modelsLoaded++;
if(f._modelsLoaded>=f._totalModels)f._modelsReady=!0,f._controllersReady&&b(document).trigger("jqmvc:loaded")};e.onerror=function(a){console.log("error ",a)};b("head").append(e);delete e}})}}};var g=document.location.protocol+"//"+document.location.host,h=[],a={},e={},c={};b.mvc.controller={};b.mvc.controller.create=function(d,f){var j=!0;b.mvc.controller[d]=f;a[d]=0;e[d]=0;f.hasOwnProperty("init")&&(c[d]=f);if(f.hasOwnProperty("views")&&(f.views.length>0||Object.keys(f.views).length)>0)for(var i in j=
!1,a[d]=f.views.length||Object.keys(f.views).length,f.views){var g=typeof i==="number"?f.views[i]:i;!h[g]&&jq("#"+g).length==0&&(b.mvc.controller.addView(f.views[i],d,g),h[g]=1)}j&&(b(document).trigger(d+":ready",{name:d}),c[d]&&c[d].init.apply(c[d]))};b.mvc.route=function(a,f){a.indexOf(g)===0&&(a=a.substring(g.length,a.length));a[0]=="/"&&(a=a.substr(1));a=a.split("/");if(a.length>1)var e=a.splice(0,1),c=a.splice(0,1);else e=a[0],c="default";if(b.mvc.controller[e]&&b.mvc.controller[e].hasOwnProperty(c))return f&&
f.preventDefault(),b.mvc.controller[e][c].apply(b.mvc.controller[e],a),!0;return!1};b.mvc.addRoute=function(a,e){a.indexOf(g)===0&&(a=a.substring(g.length,a.length));a[0]=="/"&&(a=a.substr(1));a=a.split("/");if(a.length>1)var c=a.splice(0,1),h=a.splice(0,1);else c=a[0],h="default";b.mvc.controller[c]||(b.mvc.controller[c]={});b.mvc.controller[c][h]=e};b.mvc.controller.addView=function(d,f,h){b.get(d,function(d){b(document.body).append(b("<script type='"+b.mvc.app._templateType+"' id='"+h+"'>"+d+"<\/script>"));
e[f]++;e[f]==a[f]&&(b(document).trigger(f+":ready",{name:f}),c[f]&&c[f].init.apply(c[f]))})};if(b.ui)b.ui.customClickHandler=b.mvc.route;else b(document).on("click","a",function(a){b.mvc.route(a.target.href,a)})})(jq);
(function(b){storageAdapters={};var g={};b.mvc.model=function(a,e){e&&e.modelName&&delete e.modelName;e&&e.id&&delete e.id;g[a]||(g[a]=e);b.extend(this,e);this.modelName=a};b.mvc.model.prototype={get:function(a,e){var c=this,d=new b.mvc.model(this.modelName,g[this.modelName]);storageAdapters[this.modelName].get(a,function(f){d=b.extend(d,f);d.modelName=c.modelName;d.id=a;if(e)return e(d);return d})},getAll:function(a){return storageAdapters[this.modelName].getAll(this.modelName,a)},save:function(a){return storageAdapters[this.modelName].save(this,
a)},remove:function(a){return storageAdapters[this.modelName].remove(this,a)},set:function(a,e){if(b.isObject(a))for(var c in a&&a.modelName&&delete a.modelName,a&&a.id&&delete a.id,a)this.hasOwnProperty(c)&&(this[c]=a[c]);else a.toLowerCase()!="id"&&a.toLowerCase()!="modelName"&&(this[a]=e)}};b.mvc.model.extend=function(a,e,c){storageAdapters[a]=c?c:(h.linkerCache[a]={},h);return function(){return new b.mvc.model(a,e)}};var h={linkerCache:{},save:function(a,e){if(!a.id)a.id=b.uuid();window.localStorage.setItem(a.id,
JSON.stringify(a));this.linkerCache[a.modelName][a.id]=1;window.localStorage.setItem(a.modelName+"_linker",JSON.stringify(this.linkerCache[a.modelName]));b(document).trigger(a.modelName+":save",a);if(e)return e(a)},get:function(a,b){var c=window.localStorage.getItem(a);try{c=JSON.parse(c)}catch(d){c={}}return b(c)},getAll:function(a,b){var c=JSON.parse(window.localStorage.getItem(a+"_linker")),d=[],f;for(f in c)if(localStorage[f]){var h=JSON.parse(localStorage[f]);h.modelName=a;h.id=f;d.push(h)}else delete c[f];
this.linkerCache[a]=c?c:{};window.localStorage.setItem(a+"_linker",JSON.stringify(this.linkerCache[a]));return b(d)},remove:function(a,e){window.localStorage.removeItem(a.id);delete this.linkerCache[a.modelName][a.id];window.localStorage.setItem(a.modelName+"_linker",JSON.stringify(this.linkerCache[a.modelName]));b(document).trigger(a.modelName+":remove",a.id);if(e)return e(a)}}})(jq);
(function(b){b.template=function(b,a){return g(b,a)};b.tmpl=function(h,a){return b(g(h,a))};var g=function(b,a){a||(a={});return tmpl(b,a)};(function(){var b={};this.tmpl=function e(c,d){var f=!/\W/.test(c)?b[c]=b[c]||e(document.getElementById(c).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+c.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+
"');}return p.join('');");return d?f(d):f}})()})(jq);
